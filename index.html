<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Chat - Like Gemini (Free GLM-4.5-Air)</title>
  <style>
    body { margin:0; font-family: system-ui, sans-serif; background: linear-gradient(135deg, #e0f2fe, #dbeafe); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:16px; color:#111827; }
    .container { width:100%; max-width:880px; height:92vh; background:white; border-radius:24px; box-shadow:0 12px 40px rgba(0,0,0,0.15); overflow:hidden; display:flex; flex-direction:column; }
    .header { background:#2563eb; color:white; padding:18px 24px; font-size:1.4rem; font-weight:600; text-align:center; }
    .chat { flex:1; padding:24px; overflow-y:auto; display:flex; flex-direction:column; gap:18px; }
    .msg { max-width:82%; padding:14px 20px; border-radius:22px; line-height:1.5; font-size:1.05rem; }
    .user-msg { align-self:flex-end; background:#bfdbfe; color:#1e40af; border-bottom-right-radius:6px; }
    .ai-msg { align-self:flex-start; background:#f3f4f6; color:#111827; border-bottom-left-radius:6px; }
    .error-msg { align-self:center; background:#fee2e2; color:#b91c1c; padding:14px 22px; border-radius:14px; font-weight:500; max-width:90%; white-space:pre-wrap; }
    .typing { align-self:flex-start; color:#6b7280; font-style:italic; padding:14px 20px; }
    .input-area { padding:18px 24px; border-top:1px solid #e5e7eb; background:white; display:flex; gap:14px; }
    #input { flex:1; padding:14px 20px; border:1px solid #d1d5db; border-radius:9999px; font-size:1.05rem; outline:none; }
    #input:focus { border-color:#2563eb; box-shadow:0 0 0 4px rgba(37,99,235,0.15); }
    #send { padding:14px 34px; background:#2563eb; color:white; border:none; border-radius:9999px; font-weight:600; cursor:pointer; }
    #send:hover:not(:disabled) { background:#1d4ed8; }
    #send:disabled { background:#93c5fd; cursor:not-allowed; }
    .chat::-webkit-scrollbar { width:8px; }
    .chat::-webkit-scrollbar-thumb { background:#9ca3af; border-radius:4px; }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">AI Chat - GLM-4.5-Air (Free)</div>
    <div class="chat" id="chat"></div>
    <div class="input-area">
      <input id="input" type="text" placeholder="Ask me anything..." autocomplete="off"/>
      <button id="send">Send</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const API_URL = "https://openrouter.ai/api/v1/chat/completions";
    const API_KEY = "sk-or-v1-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"; // â† PASTE YOUR **NEW** KEY HERE
    const MODEL = "z-ai/glm-4.5-air:free"; // Confirmed free & good quality

    let messages = [
      { role: "system", content: "You are a helpful, friendly, and intelligent AI assistant." }
    ];

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    function addMsg(role, content, isError = false) {
      const div = document.createElement("div");
      div.className = `msg ${role === "user" ? "user-msg" : "ai-msg"} ${isError ? "error-msg" : ""}`;
      div.innerHTML = isError ? content : marked.parse(content);
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    let typing = null;
    function showTyping() {
      if (typing) return;
      typing = document.createElement("div");
      typing.className = "typing";
      typing.textContent = "AI is thinking...";
      chat.appendChild(typing);
      chat.scrollTop = chat.scrollHeight;
    }
    function hideTyping() {
      if (typing) { typing.remove(); typing = null; }
    }

    async function send() {
      const text = input.value.trim();
      if (!text) return;

      sendBtn.disabled = true;
      input.disabled = true;
      input.value = "";

      addMsg("user", text);
      messages.push({ role: "user", content: text });

      showTyping();

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: MODEL,
            messages: messages,
            stream: true
          })
        });

        if (!res.ok) {
          let err = await res.text();
          try { err = JSON.parse(err).error?.message || err; } catch {}
          throw new Error(`API error (${res.status}): ${err}`);
        }

        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let aiText = "";
        let aiDiv = null;

        hideTyping();

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          const chunk = decoder.decode(value);
          const lines = chunk.split("\n").filter(l => l.trim());

          for (const line of lines) {
            if (line.startsWith("data: ")) {
              const data = line.slice(6);
              if (data === "[DONE]") continue;
              try {
                const parsed = JSON.parse(data);
                const delta = parsed.choices?.[0]?.delta?.content;
                if (delta) {
                  aiText += delta;
                  if (!aiDiv) {
                    aiDiv = addMsg("assistant", aiText);
                  } else {
                    aiDiv.innerHTML = marked.parse(aiText);
                  }
                  chat.scrollTop = chat.scrollHeight;
                }
              } catch {}
            }
          }
        }

        if (aiText) messages.push({ role: "assistant", content: aiText });

      } catch (err) {
        console.error(err);
        addMsg("assistant", `Error: ${err.message}\n\nQuick fixes:\n1. Use a **NEW** API key (generate at openrouter.ai/keys)\n2. Try model: tngtech/deepseek-r1t2-chimera:free or arcee-ai/trinity-large-preview:free\n3. Test in incognito or different network/VPN`, true);
      } finally {
        hideTyping();
        sendBtn.disabled = false;
        input.disabled = false;
        input.focus();
      }
    }

    sendBtn.onclick = send;
    input.onkeypress = e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    };

    addMsg("assistant", "Hello! This chat uses **GLM-4.5-Air (free)** â€” fast and smart.\nPaste your **new** API key above and try sending a message! ðŸš€");
  </script>
</body>
</html>
